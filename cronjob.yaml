apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: pgbackup
spec:
  schedule: "*/60 * * * *"
  concurrencyPolicy: "Forbid"
  startingDeadlineSeconds: 200
  suspend: false
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 1
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
            parent: "cronjobpi"
        spec:
          volumes:
            - name: subcellular-backup
              persistentVolumeClaim:
                claimName: subcellular-backup
          containers:
            - name: pgbackup
              image: postgres
              env:
                - name: PGPASSWORD
                  value: "i5J43RmPm6oCVU2Y"
                - name: PGDATABASE
                  value: "subcellular-app"
              command:
                [
                  "pg_dump",
                  "-h",
                  "172.30.12.27",
                  "-p",
                  "5432",
                  "-U",
                  "user3XX",
                  "-w",
                  "-f",
                  "/subcellular-backup/backup.sql"

                ]
              volumeMounts:
                - name: subcellular-backup
                  mountPath: /subcellular-backup
          restartPolicy: OnFailure
